# v0.5.0 Feature Design

_创建时间: 2026-02-25_

---

## FEATURE_006: Skills 系统

### 1. 概述

类似 Claude Code 的 Skills 系统，允许用户定义和加载可复用的技能/命令模块。

### 2. 影响范围

**需要创建的文件**:
- `packages/repl/src/skills/index.ts` - 技能系统入口
- `packages/repl/src/skills/skill-loader.ts` - 技能加载器
- `packages/repl/src/skills/skill-registry.ts` - 技能注册表
- `packages/repl/src/skills/types.ts` - 技能类型定义
- `packages/repl/src/skills/builtin/` - 内置技能目录

**需要修改的文件**:
- `packages/repl/src/interactive/commands.ts` - 集成技能调用
- `packages/repl/src/ui/InkREPL.tsx` - 技能 UI 反馈

### 3. 技术方案

**技能定义格式** (SKILL.md):
```markdown
---
name: code-review
description: 代码审查技能
triggers:
  - review
  - 审查
  - code review
---

# Code Review Skill

执行代码审查的提示词模板...

## 参数
- scope: 审查范围 (file|directory|project)
- focus: 审查重点 (security|performance|style|all)
```

**技能发现机制**:
1. 扫描 `.claude/skills/` 目录
2. 解析 SKILL.md 文件
3. 注册到技能注册表
4. LLM 可通过工具调用技能

### 4. 接口契约

```typescript
interface Skill {
  name: string;
  description: string;
  triggers: string[];
  template: string;
  parameters?: SkillParameter[];
}

interface SkillParameter {
  name: string;
  type: 'string' | 'number' | 'boolean';
  required: boolean;
  default?: unknown;
}

interface SkillContext {
  input: string;
  parameters: Record<string, unknown>;
  messages: Message[];
  workingDirectory: string;
}
```

### 5. 实现步骤

1. **创建技能类型定义** → types.ts
2. **实现技能加载器** → skill-loader.ts
3. **实现技能注册表** → skill-registry.ts
4. **创建内置技能** → builtin/
5. **集成到命令系统** → commands.ts
6. **添加 /skills 命令**

### 6. 验收标准

- [ ] 支持 `.claude/skills/` 目录加载技能
- [ ] 内置至少 3 个常用技能
- [ ] `/skills` 命令列出所有可用技能
- [ ] `/skill-name` 可调用技能
- [ ] 技能参数正确传递

---

## FEATURE_007: 主题系统完善

### 1. 概述

将所有硬编码的 chalk 颜色改为使用主题系统，实现全局主题切换。

### 2. 影响范围

**需要修改的文件**:
- `packages/repl/src/interactive/commands.ts` - 使用主题颜色
- `packages/repl/src/interactive/project-commands.ts` - 使用主题颜色
- `packages/repl/src/ui/themes/index.ts` - 添加主题切换
- `packages/repl/src/ui/contexts/` - 添加 ThemeContext

### 3. 技术方案

**ThemeContext**:
```typescript
interface ThemeContextValue {
  theme: Theme;
  setTheme: (name: string) => void;
  themeColors: ThemeColors;
}
```

**命令颜色迁移**:
```typescript
// 之前
console.log(chalk.cyan('消息'));

// 之后
console.log(chalk.hex(theme.colors.primary)('消息'));
```

### 4. 接口契约

**新增命令**:
- `/theme` - 显示当前主题
- `/theme <name>` - 切换主题
- `/theme list` - 列出所有可用主题

### 5. 实现步骤

1. **创建 ThemeContext**
2. **修改命令系统注入主题**
3. **迁移 commands.ts 的 chalk 调用**
4. **迁移 project-commands.ts 的 chalk 调用**
5. **添加 /theme 命令**
6. **主题配置持久化**

### 6. 验收标准

- [ ] `/theme` 命令可用
- [ ] 命令输出颜色随主题变化
- [ ] 主题选择持久化
- [ ] dark 和 minimal 主题都正常工作
